---
import type { TabInfo } from "@mintlify/astro/helpers";
import { SearchBar } from "./SearchBar";
import { MobileActionButtons, MobileNavToggle } from "./MobileHeaderActions";
import { GitHubPrimaryLink } from "./GitHubPrimaryLink";

interface HeaderLink {
  label: string;
  href: string;
}

interface HeaderPrimaryButton {
  type: "button";
  label: string;
  href: string;
}

interface HeaderPrimaryGithub {
  type: "github";
  href: string;
  repo?: string;
}

type HeaderPrimary = HeaderPrimaryButton | HeaderPrimaryGithub;

interface Props {
  tabs: TabInfo[] | null;
  pageTitle?: string;
  groupName?: string;
  siteName?: string;
  logoHref?: string;
  logoSrc?: string;
  navbarLinks?: HeaderLink[];
  navbarPrimary?: HeaderPrimary;
}

const {
  tabs,
  pageTitle,
  groupName,
  siteName = "Documentation",
  logoHref = "/",
  logoSrc,
  navbarLinks = [],
  navbarPrimary
} = Astro.props;

const usingTabs = tabs && tabs.length > 0;
---

<header class="sticky top-0 w-full px-5 lg:px-8 z-50">
  <div class="absolute left-1/2 -translate-x-1/2 w-screen h-full backdrop-blur border-b border-gray-500/5 bg-white/95 supports-backdrop-blur:bg-white/70" />
  <div class="relative">
    <div class="relative">
      <div class="relative flex items-center h-16 min-w-0">
        <div
          class:list={[
            "h-full relative flex-1 flex items-center justify-between gap-x-4 min-w-0 border-b border-gray-500/5",
            !usingTabs && "lg:border-none"
          ]}
        >
          <div class="flex items-center shrink-0 lg:flex-1 min-w-0">
            <a href={logoHref} class="flex items-center gap-3 shrink-0">
              {logoSrc ? (
                <img src={logoSrc} alt={siteName} class="h-8 w-8 rounded-xl object-contain" />
              ) : (
                <div class="h-8 w-8 rounded-xl bg-(--primary)" />
              )}
              <span class="font-semibold text-gray-900 hidden sm:block truncate">{siteName}</span>
            </a>
          </div>

          <div class="flex-1 hidden lg:flex items-center justify-center min-w-0">
            <div class="w-full max-w-xl">
              <SearchBar client:load />
            </div>
          </div>

          <MobileActionButtons
            navbarLinks={navbarLinks}
            navbarPrimary={navbarPrimary}
            client:load
          />

          <div class="flex-1 hidden lg:flex items-center justify-end gap-3">
            {navbarLinks.map((link) => (
              <a class="text-gray-700 text-sm hover:text-gray-900" href={link.href}>{link.label}</a>
            ))}
            {navbarPrimary?.type === "button" ? (
              <a
                class="inline-flex items-center gap-1 rounded-xl bg-(--primary) px-3.5 py-2 text-sm font-semibold text-white hover:opacity-90"
                href={navbarPrimary.href}
              >
                {navbarPrimary.label}
              </a>
            ) : navbarPrimary?.type === "github" ? (
              <GitHubPrimaryLink
                client:load
                href={navbarPrimary.href}
                repo={navbarPrimary.repo}
                className="inline-flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900"
              />
            ) : null}
          </div>
        </div>
      </div>

      {pageTitle ? <MobileNavToggle pageTitle={pageTitle} groupName={groupName} client:load /> : null}
    </div>

    {
      usingTabs && (
        <div class="hidden lg:flex h-12">
          <div class="h-full flex text-sm gap-x-6">
            {tabs.map((tab) => (
              <a
                href={tab.href}
                class:list={[
                  "group relative h-full gap-2 flex items-center font-medium text-gray-600 hover:text-gray-800",
                  tab.isActive && "text-gray-800 [text-shadow:-0.2px_0_0_currentColor,0.2px_0_0_currentColor]"
                ]}
              >
                {tab.name}
                <div
                  class:list={[
                    "absolute bottom-0 h-[1.5px] w-full left-0",
                    tab.isActive ? "bg-(--primary)" : "group-hover:bg-gray-200"
                  ]}
                />
              </a>
            ))}
          </div>
        </div>
      )
    }
  </div>
</header>
